

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src.smart_watch.core.ErrorHandler &mdash; SmartWatch Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.jpg"/>
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=3afee5ec"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../_static/translations.js?v=e6b791cb"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            SmartWatch
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/introduction.html">Présentation du projet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/introduction.html#sommaire">Sommaire</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Démarrage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/docker.html">Utilisation avec Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/configuration.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture technique</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/main.html">Orchestrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/diagramme.html">Pipeline de traitement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/bdd.html">Base de données</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../architecture/stack.html">Stack technique</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules/config/index.html">Modules Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules Core</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules/core/index.html">Modules Core</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules/processing/index.html">Modules Processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules Reporting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules/reporting/index.html">Modules Reporting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules Utils</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules/utils/index.html">Modules Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">SmartWatch</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Code du module</a></li>
      <li class="breadcrumb-item active">src.smart_watch.core.ErrorHandler</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Code source de src.smart_watch.core.ErrorHandler</h1><div class="highlight"><pre>
<span></span><span class="c1"># Gestionnaire centralisé d&#39;erreurs pour le projet smart_watch</span>
<span class="c1"># Documentation : https://datagora-erasme.github.io/smart_watch/source/modules/core/ErrorHandler.html</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.Logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogLevel</span><span class="p">,</span> <span class="n">create_logger</span>


<div class="viewcode-block" id="ErrorSeverity">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorSeverity">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ErrorSeverity</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumération représentant le niveau de gravité d&#39;une erreur.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        LOW (str): erreur mineure, le traitement peut continuer.</span>
<span class="sd">        MEDIUM (str): erreur modérée, le traitement peut continuer avec une dégradation des fonctionnalités.</span>
<span class="sd">        HIGH (str): erreur grave, il est recommandé d&#39;arrêter le traitement.</span>
<span class="sd">        CRITICAL (str): erreur critique, le traitement ne peut pas continuer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">LOW</span> <span class="o">=</span> <span class="s2">&quot;low&quot;</span>
    <span class="n">MEDIUM</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
    <span class="n">CRITICAL</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span></div>



<div class="viewcode-block" id="ErrorCategory">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorCategory">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ErrorCategory</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumération d&#39;erreurs utilisées pour classifier les exceptions dans l&#39;application.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        CONFIGURATION (str): erreur liée à la configuration de l&#39;application.</span>
<span class="sd">        DATABASE (str): erreur en lien avec la base de données.</span>
<span class="sd">        NETWORK (str): erreur de connexion ou de communication réseau.</span>
<span class="sd">        LLM (str): erreur liée au modèle de langage (LLM).</span>
<span class="sd">        FILE_IO (str): erreur lors des opérations d&#39;entrée/sortie sur les fichiers.</span>
<span class="sd">        VALIDATION (str): erreur de validation des données ou des paramètres.</span>
<span class="sd">        CONVERSION (str): erreur lors de la conversion de données ou de formats.</span>
<span class="sd">        PARSING (str): erreur lors de l&#39;analyse ou du parsing de données.</span>
<span class="sd">        EMAIL (str): erreur lors de l&#39;envoi ou de la réception d&#39;emails.</span>
<span class="sd">        EMBEDDINGS (str): erreur lors de l&#39;utilisation des embeddings.</span>
<span class="sd">        UNKNOWN (str): erreur non catégorisée.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CONFIGURATION</span> <span class="o">=</span> <span class="s2">&quot;configuration&quot;</span>
    <span class="n">DATABASE</span> <span class="o">=</span> <span class="s2">&quot;database&quot;</span>
    <span class="n">NETWORK</span> <span class="o">=</span> <span class="s2">&quot;network&quot;</span>
    <span class="n">LLM</span> <span class="o">=</span> <span class="s2">&quot;llm&quot;</span>
    <span class="n">FILE_IO</span> <span class="o">=</span> <span class="s2">&quot;file_io&quot;</span>
    <span class="n">VALIDATION</span> <span class="o">=</span> <span class="s2">&quot;validation&quot;</span>
    <span class="n">CONVERSION</span> <span class="o">=</span> <span class="s2">&quot;conversion&quot;</span>
    <span class="n">PARSING</span> <span class="o">=</span> <span class="s2">&quot;parsing&quot;</span>
    <span class="n">EMAIL</span> <span class="o">=</span> <span class="s2">&quot;email&quot;</span>
    <span class="n">EMBEDDINGS</span> <span class="o">=</span> <span class="s2">&quot;embeddings&quot;</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span></div>



<div class="viewcode-block" id="ErrorContext">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorContext">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ErrorContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classe représentant le contexte d&#39;une erreur survenue dans l&#39;application.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        module (str): nom du module où l&#39;erreur s&#39;est produite.</span>
<span class="sd">        function (str): nom de la fonction où l&#39;erreur s&#39;est produite.</span>
<span class="sd">        operation (str): description de l&#39;opération en cours lors de l&#39;erreur.</span>
<span class="sd">        data (Optional[Dict[str, Any]]): données supplémentaires liées à l&#39;erreur.</span>
<span class="sd">        user_message (Optional[str]): message destiné à l&#39;utilisateur concernant l&#39;erreur.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">module</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">function</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">user_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="HandledError">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.HandledError">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HandledError</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classe représentant une erreur gérée.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        category (ErrorCategory): catégorie de l&#39;erreur.</span>
<span class="sd">        severity (ErrorSeverity): niveau de sévérité.</span>
<span class="sd">        exception (Exception): exception associée à l&#39;erreur.</span>
<span class="sd">        context (ErrorContext): contexte dans lequel l&#39;erreur s&#39;est produite.</span>
<span class="sd">        timestamp (str): date et heure de l&#39;occurrence de l&#39;erreur.</span>
<span class="sd">        traceback (str): trace complète de l&#39;erreur.</span>
<span class="sd">        resolved (bool): indique si l&#39;erreur a été résolue.</span>
<span class="sd">        solution_attempted (Optional[str]): description de la solution tentée, si applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">category</span><span class="p">:</span> <span class="n">ErrorCategory</span>
    <span class="n">severity</span><span class="p">:</span> <span class="n">ErrorSeverity</span>
    <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">ErrorContext</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">traceback</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resolved</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">solution_attempted</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ErrorHandler">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire centralisé des erreurs.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ErrorHandler.__init__">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise le gestionnaire d&#39;erreurs.</span>

<span class="sd">        Ce constructeur configure le logger pour le module ErrorHandler, initialise le registre des erreurs traitées, et prépare les gestionnaires spécialisés pour chaque catégorie d&#39;erreur.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            logger: logger dédié au module ErrorHandler.</span>
<span class="sd">            error_registry: liste des erreurs traitées par le gestionnaire.</span>
<span class="sd">            category_handlers: dictionnaire associant chaque catégorie d&#39;erreur à sa méthode de gestion spécialisée.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">create_logger</span><span class="p">(</span>
            <span class="n">module_name</span><span class="o">=</span><span class="s2">&quot;ErrorHandler&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Registre des erreurs traitées</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">HandledError</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Les gestionnaires spécialisés sont conservés</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">CONFIGURATION</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_configuration_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">DATABASE</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_database_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">NETWORK</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_network_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">LLM</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_llm_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">FILE_IO</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_file_io_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">VALIDATION</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_validation_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">PARSING</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_parsing_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">EMAIL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_email_error</span><span class="p">,</span>
            <span class="n">ErrorCategory</span><span class="o">.</span><span class="n">EMBEDDINGS</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_embeddings_error</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="ErrorHandler.handle_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler.handle_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_error</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">ErrorContext</span><span class="p">,</span>
        <span class="n">severity</span><span class="p">:</span> <span class="n">ErrorSeverity</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="n">ErrorCategory</span><span class="p">,</span>
        <span class="n">reraise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">default_return</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite une exception de manière centralisée, en enregistrant l&#39;erreur, en la journalisant, et en appliquant un traitement spécialisé selon la catégorie et la gravité.</span>

<span class="sd">        Peut relancer l&#39;exception ou retourner une valeur par défaut.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception (Exception): l&#39;exception à traiter.</span>
<span class="sd">            context (ErrorContext): contexte additionnel lié à l&#39;erreur.</span>
<span class="sd">            severity (ErrorSeverity): gravité de l&#39;erreur.</span>
<span class="sd">            category (ErrorCategory): catégorie de l&#39;erreur.</span>
<span class="sd">            reraise (bool, optionnel): si True, relance l&#39;exception après traitement. Par défaut à False.</span>
<span class="sd">            default_return (Any, optionnel): valeur à retourner si aucun résultat n&#39;est produit par le traitement spécialisé.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: résultat du traitement spécialisé, ou la valeur par défaut si aucun résultat n&#39;est produit.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: relance l&#39;exception d&#39;origine si `reraise` est True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Création de l&#39;erreur traitée</span>
        <span class="n">handled_error</span> <span class="o">=</span> <span class="n">HandledError</span><span class="p">(</span>
            <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">severity</span><span class="p">,</span>
            <span class="n">exception</span><span class="o">=</span><span class="n">exception</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="n">traceback</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># Enregistrement de l&#39;erreur</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handled_error</span><span class="p">)</span>

        <span class="c1"># Logging selon la gravité</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="n">handled_error</span><span class="p">)</span>

        <span class="c1"># Traitement spécialisé</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_specialized_handling</span><span class="p">(</span><span class="n">handled_error</span><span class="p">)</span>

        <span class="c1"># Relancer si demandé</span>
        <span class="k">if</span> <span class="n">reraise</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exception</span>

        <span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default_return</span></div>


<div class="viewcode-block" id="ErrorHandler._log_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._log_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handled_error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enregistre une erreur gérée dans le système de logs avec différents niveaux de gravité.</span>

<span class="sd">        Le traceback complet est géré par le décorateur pour éviter la duplication.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Message de base</span>
        <span class="n">base_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">handled_error</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">] &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">module</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">function</span><span class="si">}</span><span class="s2">: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">operation</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Message d&#39;erreur</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_message</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">handled_error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Message utilisateur si disponible</span>
        <span class="k">if</span> <span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">user_message</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">user_message</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Données contextuelles</span>
        <span class="k">if</span> <span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | Data: </span><span class="si">{</span><span class="n">handled_error</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Mapping gravité -&gt; niveau de log</span>
        <span class="n">log_level_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">LOW</span><span class="p">:</span> <span class="n">LogLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
            <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">:</span> <span class="n">LogLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span> <span class="n">LogLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
            <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span> <span class="n">LogLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">log_level</span> <span class="o">=</span> <span class="n">log_level_mapping</span><span class="p">[</span><span class="n">handled_error</span><span class="o">.</span><span class="n">severity</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log_level</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span></div>


        <span class="c1"># Note: Le traceback est maintenant géré par le décorateur</span>
        <span class="c1"># pour éviter la duplication et être plus précis sur le moment de capture</span>

<div class="viewcode-block" id="ErrorHandler._apply_specialized_handling">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._apply_specialized_handling">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_specialized_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handled_error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applique un traitement spécialisé à une erreur gérée selon sa catégorie.</span>

<span class="sd">        Cette méthode tente de récupérer un gestionnaire spécialisé pour la catégorie de l&#39;erreur fournie. Si un gestionnaire est trouvé, il est exécuté avec l&#39;erreur en paramètre. En cas d&#39;exception lors de l&#39;exécution du gestionnaire, une erreur est enregistrée dans le logger. Si aucun gestionnaire n&#39;est disponible ou en cas d&#39;échec, la méthode retourne None.</span>

<span class="sd">        Args:</span>
<span class="sd">            handled_error (HandledError): l&#39;erreur à traiter, encapsulée dans un objet HandledError.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: le résultat du gestionnaire spécialisé si disponible et sans erreur, sinon None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category_handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">handled_error</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handler</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">handled_error</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur dans le gestionnaire spécialisé: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_configuration_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_configuration_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_configuration_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gère les erreurs de configuration spécifiques et propose des solutions adaptées.</span>

<span class="sd">        Cette méthode analyse l&#39;exception contenue dans l&#39;objet `HandledError` et, selon le type d&#39;erreur (KeyError ou ValueError), elle renseigne une tentative de solution et suggère des actions correctives via le logger.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet d&#39;erreur contenant l&#39;exception à traiter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours None, cette méthode est utilisée pour ses effets de bord (journalisation et modification de l&#39;objet d&#39;erreur).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">missing_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Variable manquante: </span><span class="si">{</span><span class="n">missing_key</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Suggestions de solutions</span>
            <span class="n">config_suggestions</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;LLM_API_KEY_OPENAI&quot;</span><span class="p">:</span> <span class="s2">&quot;Ajoutez votre clé API OpenAI pour LLM dans le fichier .env&quot;</span><span class="p">,</span>
                <span class="s2">&quot;LLM_API_KEY_MISTRAL&quot;</span><span class="p">:</span> <span class="s2">&quot;Ajoutez votre clé API Mistral dans le fichier .env&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DB_FILE&quot;</span><span class="p">:</span> <span class="s2">&quot;Vérifiez le chemin de la base de données&quot;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">missing_key</span> <span class="ow">in</span> <span class="n">config_suggestions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Solution suggérée: </span><span class="si">{</span><span class="n">config_suggestions</span><span class="p">[</span><span class="n">missing_key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Valeur de configuration invalide&quot;</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_database_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_database_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_database_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gère les erreurs spécifiques liées à la base de données et propose des solutions.</span>

<span class="sd">        Cette méthode analyse le message d&#39;exception pour détecter des erreurs courantes telles que l&#39;absence de table ou le verrouillage de la base de données. Elle consigne une solution adaptée dans le logger et met à jour l&#39;attribut `solution_attempted` de l&#39;objet d&#39;erreur.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet représentant l&#39;erreur interceptée, contenant l&#39;exception et les informations associées.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours None, cette méthode est utilisée pour ses effets de bord (journalisation et mise à jour de l&#39;erreur).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;no such table&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Table manquante - initialisation requise&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Solution: Exécutez l&#39;initialisation de la base de données&quot;</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;database is locked&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Base de données verrouillée&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Fermez les autres connexions à la base&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_network_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_network_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_network_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gère les erreurs liées au réseau en analysant le type d&#39;exception et en proposant une solution.</span>

<span class="sd">        Cette méthode vérifie si l&#39;erreur est une erreur de connexion ou un timeout réseau, puis met à jour la tentative de solution dans l&#39;objet `HandledError` et enregistre une suggestion dans le logger.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet contenant l&#39;exception à traiter et les informations associées.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours None, cette méthode ne retourne pas de valeur utile.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">):</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Problème de connexion réseau&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Vérifiez votre connexion internet&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Timeout réseau&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Augmentez le timeout ou réessayez plus tard&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_llm_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_llm_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_llm_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite les erreurs liées au LLM et propose des solutions ou messages adaptés.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;erreur interceptée contenant l&#39;exception à analyser.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: retourne un message d&#39;erreur spécifique si un timeout est détecté, sinon None.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - Modifie l&#39;attribut `solution_attempted` de l&#39;objet error selon le type d&#39;erreur détecté.</span>
<span class="sd">            - Loggue une solution adaptée via le logger pour les erreurs de clé API ou de limite de taux.</span>
<span class="sd">            - Retourne un message d&#39;erreur pour les timeouts afin de permettre la poursuite du traitement.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">error_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;api key&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Clé API invalide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Vérifiez votre clé API LLM&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;rate limit&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Limite de taux atteinte&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Attendez avant de réessayer&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;timeout&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Timeout LLM&quot;</span>
            <span class="k">return</span> <span class="s2">&quot;Erreur Timeout LLM&quot;</span>  <span class="c1"># Valeur de retour pour continuer</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_file_io_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_file_io_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_file_io_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gère les erreurs liées aux opérations d&#39;entrée/sortie de fichiers.</span>

<span class="sd">        Cette méthode analyse l&#39;exception contenue dans l&#39;objet `HandledError` et adapte le message de solution proposée selon le type d&#39;erreur rencontré :</span>
<span class="sd">        - Si le fichier est introuvable (`FileNotFoundError`), elle précise le nom du fichier manquant.</span>
<span class="sd">        - Si les permissions sont insuffisantes (`PermissionError`), elle indique ce problème.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet contenant l&#39;exception à traiter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours `None`, cette méthode modifie l&#39;objet d&#39;erreur en place.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">):</span>
            <span class="n">missing_file</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;fichier inconnu&quot;</span><span class="p">)</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fichier manquant: </span><span class="si">{</span><span class="n">missing_file</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Permissions insuffisantes&quot;</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_parsing_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_parsing_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_parsing_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gère les erreurs de parsing des données d&#39;entrée.</span>

<span class="sd">        Cette méthode modifie l&#39;attribut `solution_attempted` de l&#39;erreur pour indiquer qu&#39;une erreur de parsing a eu lieu, enregistre une information dans le logger pour suggérer de vérifier le format des données d&#39;entrée, puis retourne `None` afin que la valeur par défaut définie par le décorateur soit utilisée.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet représentant l&#39;erreur de parsing rencontrée.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours `None`, pour permettre l&#39;utilisation d&#39;une valeur par défaut.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Erreur de parsing des données&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Solution: Vérifiez le format des données d&#39;entrée. L&#39;opération a continué avec une valeur par défaut.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Retourne None pour que la valeur par défaut du décorateur soit utilisée</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_validation_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_validation_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_validation_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite une erreur de validation et retourne une réponse structurée.</span>

<span class="sd">        Cette méthode modifie l&#39;attribut `solution_attempted` de l&#39;objet `error` pour indiquer qu&#39;une tentative de solution a été effectuée, puis retourne un dictionnaire contenant un message d&#39;erreur et les détails de l&#39;exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet représentant l&#39;erreur de validation à traiter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: un dictionnaire avec les clés &#39;error&#39; et &#39;details&#39; décrivant l&#39;échec de la validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Données invalides&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Validation failed&quot;</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)}</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_email_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_email_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_email_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite les erreurs liées à l&#39;envoi d&#39;emails et propose une solution adaptée.</span>

<span class="sd">        Cette méthode analyse le message d&#39;exception associé à une erreur d&#39;email, puis définit une tentative de solution en fonction du type d&#39;erreur détectée (authentification ou connexion SMTP).</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet représentant l&#39;erreur à traiter, contenant l&#39;exception d&#39;origine.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours None. La solution proposée est enregistrée dans l&#39;attribut `solution_attempted` de l&#39;objet error.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">error_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;authentication&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Erreur d&#39;authentification email&quot;</span>

        <span class="k">elif</span> <span class="s2">&quot;connection&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Erreur de connexion SMTP&quot;</span>

        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler._handle_embeddings_error">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler._handle_embeddings_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_embeddings_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">HandledError</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gère les erreurs spécifiques aux embeddings.</span>

<span class="sd">        Args:</span>
<span class="sd">            error (HandledError): l&#39;objet d&#39;erreur contenant l&#39;exception à traiter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: toujours None, cette méthode est utilisée pour ses effets de bord.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;api key&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Clé API invalide pour les embeddings&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Vérifiez votre clé API pour les embeddings&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;rate limit&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Limite de taux atteinte pour les embeddings&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Solution: Attendez avant de réessayer avec les embeddings&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;timeout&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Timeout lors de la génération des embeddings&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Solution: Augmentez le timeout ou réessayez plus tard&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;mistral&quot;</span> <span class="ow">in</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="s2">&quot;Erreur spécifique au modèle Mistral. Mistral n&#39;accepte pas plus de 16384 tokens pour les embeddings.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Solution: Vérifiez la configuration du modèle Mistral et le nombre de tokens de votre texte&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span><span class="o">.</span><span class="n">solution_attempted</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Erreur inconnue lors de la génération des embeddings&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Solution: Vérifiez la configuration des embeddings / du modèle utilisé&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ErrorHandler.create_error_context">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler.create_error_context">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_error_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">function</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErrorContext</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crée un contexte d&#39;erreur pour faciliter la gestion et le suivi des erreurs dans le module.</span>

<span class="sd">        Args:</span>
<span class="sd">            module (str): nom du module où l&#39;erreur s&#39;est produite.</span>
<span class="sd">            function (str): nom de la fonction concernée par l&#39;erreur.</span>
<span class="sd">            operation (str): description de l&#39;opération en cours lors de l&#39;erreur.</span>
<span class="sd">            data (Optional[Dict[str, Any]]): données supplémentaires liées à l&#39;erreur (par défaut None).</span>
<span class="sd">            user_message (Optional[str]): message destiné à l&#39;utilisateur pour expliquer l&#39;erreur (par défaut None).</span>

<span class="sd">        Returns:</span>
<span class="sd">            ErrorContext: objet contenant toutes les informations contextuelles sur l&#39;erreur.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">ErrorContext</span><span class="p">(</span>
            <span class="n">module</span><span class="o">=</span><span class="n">module</span><span class="p">,</span>
            <span class="n">function</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">user_message</span><span class="o">=</span><span class="n">user_message</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ErrorHandler.get_error_summary">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler.get_error_summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_error_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Résume les erreurs enregistrées dans le registre d&#39;erreurs.</span>

<span class="sd">        Retourne un dictionnaire contenant le nombre total d&#39;erreurs, la répartition par catégorie et par gravité, ainsi que les cinq dernières erreurs enregistrées avec leurs détails.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]:</span>
<span class="sd">                Un dictionnaire avec les clés suivantes :</span>
<span class="sd">                    - &quot;total_errors&quot; (int): Nombre total d&#39;erreurs enregistrées.</span>
<span class="sd">                    - &quot;by_category&quot; (dict): Répartition des erreurs par catégorie.</span>
<span class="sd">                    - &quot;by_severity&quot; (dict): Répartition des erreurs par gravité.</span>
<span class="sd">                    - &quot;recent_errors&quot; (list): Liste des cinq dernières erreurs, chacune sous forme de dictionnaire contenant :</span>
<span class="sd">                        - &quot;category&quot; (str): Catégorie de l&#39;erreur.</span>
<span class="sd">                        - &quot;severity&quot; (str): Gravité de l&#39;erreur.</span>
<span class="sd">                        - &quot;exception&quot; (str): Description de l&#39;exception.</span>
<span class="sd">                        - &quot;module&quot; (str): Module où l&#39;erreur s&#39;est produite.</span>
<span class="sd">                        - &quot;timestamp&quot; (Any): Date et heure de l&#39;erreur.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;by_category&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;by_severity&quot;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="c1"># Comptage par catégorie</span>
        <span class="n">by_category</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">value</span>
            <span class="n">by_category</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_category</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Comptage par gravité</span>
        <span class="n">by_severity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="p">:</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span>
            <span class="n">by_severity</span><span class="p">[</span><span class="n">severity</span><span class="p">]</span> <span class="o">=</span> <span class="n">by_severity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="p">),</span>
            <span class="s2">&quot;by_category&quot;</span><span class="p">:</span> <span class="n">by_category</span><span class="p">,</span>
            <span class="s2">&quot;by_severity&quot;</span><span class="p">:</span> <span class="n">by_severity</span><span class="p">,</span>
            <span class="s2">&quot;recent_errors&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">exception</span><span class="p">),</span>
                    <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>  <span class="c1"># 5 dernières erreurs</span>
            <span class="p">],</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="ErrorHandler.clear_error_registry">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.ErrorHandler.clear_error_registry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_error_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Efface tous les enregistrements d&#39;erreurs du registre interne.</span>

<span class="sd">        Cette méthode vide le registre des erreurs, supprimant ainsi toutes les erreurs actuellement stockées.</span>
<span class="sd">        Elle peut être utilisée pour réinitialiser l&#39;état des erreurs avant une nouvelle opération ou après un traitement.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: si le registre d&#39;erreurs n&#39;est pas initialisé correctement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_registry</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>
</div>



<span class="c1"># Décorateur pour simplifier l&#39;usage</span>
<div class="viewcode-block" id="handle_errors">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.handle_errors">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_errors</span><span class="p">(</span>
    <span class="n">category</span><span class="p">:</span> <span class="n">ErrorCategory</span><span class="p">,</span>
    <span class="n">severity</span><span class="p">:</span> <span class="n">ErrorSeverity</span><span class="p">,</span>
    <span class="n">reraise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">default_return</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Callable</span><span class="p">],</span> <span class="n">Callable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Décorateur pour gérer les erreurs lors de l&#39;exécution d&#39;une fonction, en utilisant un gestionnaire d&#39;erreurs centralisé.</span>

<span class="sd">    Ce décorateur intercepte les exceptions levées par la fonction décorée, crée un contexte d&#39;erreur, et délègue le traitement au gestionnaire d&#39;erreurs approprié. Il permet de personnaliser la catégorie et la sévérité de l&#39;erreur, d&#39;afficher un message utilisateur, et de choisir si l&#39;exception doit être relancée ou non.</span>

<span class="sd">    Le traceback complet est automatiquement capturé pour les erreurs de sévérité HIGH et CRITICAL.</span>

<span class="sd">    Args:</span>
<span class="sd">        category (ErrorCategory): catégorie de l&#39;erreur à signaler.</span>
<span class="sd">        severity (ErrorSeverity): niveau de sévérité de l&#39;erreur.</span>
<span class="sd">        reraise (bool, optionnel): si True, relance l&#39;exception après traitement. Sinon, retourne `default_return`. Par défaut à False.</span>
<span class="sd">        default_return (Any, optionnel): valeur à retourner en cas d&#39;erreur si `reraise` est False. Par défaut à None.</span>
<span class="sd">        user_message (str, optionnel): message personnalisé à afficher à l&#39;utilisateur. Par défaut à None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Callable: Le décorateur appliqué à la fonction cible.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fonction décorateur interne qui enveloppe la fonction cible.</span>

<span class="sd">        Cette fonction interne applique le décorateur handle_errors à la fonction fournie. Elle capture les exceptions levées lors de l&#39;exécution de la fonction décorée et les traite via le gestionnaire d&#39;erreurs approprié.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Callable): la fonction à décorer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Callable: la fonction décorée enveloppée.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Fonction wrapper qui exécute la fonction décorée et gère les erreurs.</span>

<span class="sd">            Cette fonction enveloppe l&#39;exécution de la fonction décorée, capture les exceptions, et les traite via le gestionnaire d&#39;erreurs approprié. Elle gère spécifiquement les erreurs critiques avec capture complète du traceback et diagnostic spécialisé.</span>

<span class="sd">            Args:</span>
<span class="sd">                *args: arguments positionnels passés à la fonction décorée.</span>
<span class="sd">                **kwargs: arguments nommés passés à la fonction décorée.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Any: le résultat de la fonction décorée si elle s&#39;exécute sans erreur.</span>

<span class="sd">            Raises:</span>
<span class="sd">                Exception: relance l&#39;exception d&#39;origine si le paramètre reraise est True.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Récupérer le logger de l&#39;instance si disponible</span>
                <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;logger&quot;</span><span class="p">):</span>
                    <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">logger</span>

                <span class="c1"># Capture du traceback pour les erreurs critiques</span>
                <span class="k">if</span> <span class="n">severity</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span> <span class="ow">and</span> <span class="n">logger</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TRACEBACK COMPLET (erreur critique):&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

                    <span class="c1"># Diagnostic spécialisé pour AttributeError</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;DIAGNOSTIC AttributeError:&quot;</span><span class="p">)</span>
                        <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s2">&quot;object has no attribute&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="p">:</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">error_msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="n">obj_type</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;inconnu&quot;</span>
                                <span class="n">attr_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;inconnu&quot;</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Type d&#39;objet: &#39;</span><span class="si">{</span><span class="n">obj_type</span><span class="si">}</span><span class="s2">&#39;, Attribut manquant: &#39;</span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                                <span class="p">)</span>

                <span class="c1"># Récupérer l&#39;instance ErrorHandler depuis les arguments ou créer une instance globale</span>
                <span class="n">error_handler</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;error_handler&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">error_handler</span><span class="p">:</span>
                    <span class="n">error_handler</span> <span class="o">=</span> <span class="n">_get_global_error_handler</span><span class="p">()</span>

                <span class="c1"># Créer le contexte</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">error_handler</span><span class="o">.</span><span class="n">create_error_context</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="vm">__module__</span> <span class="ow">or</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                    <span class="n">function</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exécution de </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">user_message</span><span class="o">=</span><span class="n">user_message</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Traiter l&#39;erreur</span>
                <span class="k">return</span> <span class="n">error_handler</span><span class="o">.</span><span class="n">handle_error</span><span class="p">(</span>
                    <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                    <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">severity</span><span class="p">,</span>
                    <span class="n">reraise</span><span class="o">=</span><span class="n">reraise</span><span class="p">,</span>
                    <span class="n">default_return</span><span class="o">=</span><span class="n">default_return</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span></div>



<span class="c1"># Instance globale pour les cas simples</span>
<span class="n">_global_error_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ErrorHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="_get_global_error_handler">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler._get_global_error_handler">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_get_global_error_handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ErrorHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retourne l&#39;instance globale du gestionnaire d&#39;erreurs.</span>

<span class="sd">    Cette fonction vérifie si une instance globale de `ErrorHandler` existe déjà. Si ce n&#39;est pas le cas, elle en crée une nouvelle et la retourne. Cela permet de garantir qu&#39;une seule instance du gestionnaire d&#39;erreurs est utilisée dans toute l&#39;application.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ErrorHandler: l&#39;instance globale du gestionnaire d&#39;erreurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_global_error_handler</span>
    <span class="k">if</span> <span class="n">_global_error_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_global_error_handler</span> <span class="o">=</span> <span class="n">ErrorHandler</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_global_error_handler</span></div>



<div class="viewcode-block" id="get_error_handler">
<a class="viewcode-back" href="../../../../source/modules/core/ErrorHandler.html#src.smart_watch.core.ErrorHandler.get_error_handler">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_error_handler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ErrorHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Récupère l&#39;instance globale du gestionnaire d&#39;erreurs.</span>

<span class="sd">    Cette fonction permet d&#39;obtenir le gestionnaire d&#39;erreurs utilisé globalement dans l&#39;application. Elle est utile pour centraliser la gestion des exceptions et des erreurs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ErrorHandler: l&#39;instance globale du gestionnaire d&#39;erreurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_global_error_handler</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <div class="custom-footer">
    <p><a href="https://github.com/datagora-erasme/smart_watch" target="_blank">SmartWatch</a> est développé par <a href="https://github.com/berangerthomas" target="_blank">Béranger THOMAS</a> 
        pour <a href="https://erasme.org/" target="_blank">ERASME</a> / <a href="https://www.grandlyon.com/" target="_blank">Métropole de Lyon</a></p>
    </div>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>